<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Scanner AR</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: white;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .container {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .scanner-modes {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            backdrop-filter: blur(10px);
        }

        .mode-btn.active {
            background: rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.2);
        }

        .scanner-section {
            display: none;
            flex-direction: column;
            gap: 15px;
        }

        .scanner-section.active {
            display: flex;
        }

        .camera-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        #video {
            width: 100%;
            height: auto;
            aspect-ratio: 1;
            object-fit: cover;
        }

        .scanner-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            border: 3px solid #00ff88;
            border-radius: 20px;
            box-shadow: 0 0 0 99999px rgba(0, 0, 0, 0.5);
        }

        .scanner-overlay::before,
        .scanner-overlay::after {
            content: '';
            position: absolute;
            width: 30px;
            height: 30px;
            border: 4px solid #00ff88;
        }

        .scanner-overlay::before {
            top: -4px;
            left: -4px;
            border-right: none;
            border-bottom: none;
            border-top-left-radius: 20px;
        }

        .scanner-overlay::after {
            bottom: -4px;
            right: -4px;
            border-left: none;
            border-top: none;
            border-bottom-right-radius: 20px;
        }

        .upload-area {
            border: 3px dashed rgba(255, 255, 255, 0.5);
            border-radius: 20px;
            padding: 40px 20px;
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            border-color: #00ff88;
            background: rgba(255, 255, 255, 0.15);
        }

        .upload-area.drag-over {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.7;
        }

        .upload-text {
            font-size: 1.2rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .upload-subtext {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        #fileInput {
            display: none;
        }

        .preview-container {
            display: none;
            max-width: 400px;
            margin: 0 auto;
        }

        #previewImage {
            width: 100%;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(45deg, #00ff88, #00d4ff);
            color: white;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            backdrop-filter: blur(10px);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .result-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .result-section.show {
            display: block;
        }

        .result-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: #00ff88;
        }

        .result-content {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            word-break: break-all;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .result-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            font-size: 1.1rem;
            opacity: 0.8;
        }

        .loading::after {
            content: '';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60% { content: '...'; }
            80%, 100% { content: ''; }
        }

        .error {
            background: rgba(255, 82, 82, 0.2);
            border: 2px solid rgba(255, 82, 82, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            text-align: center;
            font-weight: 600;
        }

        /* Mobile Responsive */
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .scanner-overlay {
                width: 150px;
                height: 150px;
            }
            
            .upload-area {
                padding: 30px 15px;
            }
            
            .upload-icon {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîç QR Scanner AR</h1>
        <p>QR ‡¶ï‡ßã‡¶° ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶¨‡¶æ ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</p>
    </div>

    <div class="container">
        <div class="scanner-modes">
            <button class="mode-btn active" onclick="switchMode('camera')">üì∑ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶®</button>
            <button class="mode-btn" onclick="switchMode('upload')">üìÅ ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶°</button>
        </div>

        <!-- Camera Scanner Section -->
        <div id="cameraSection" class="scanner-section active">
            <div class="camera-container">
                <video id="video" autoplay playsinline></video>
                <div class="scanner-overlay"></div>
            </div>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="startCamera()">üì∑ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <button class="btn btn-secondary" onclick="stopCamera()">‚èπ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </div>

        <!-- Upload Scanner Section -->
        <div id="uploadSection" class="scanner-section">
            <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">üì∑</div>
                <div class="upload-text">‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</div>
                <div class="upload-subtext">‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶¨‡¶æ ‡¶°‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ó ‡¶ï‡¶∞‡ßá ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</div>
            </div>
            <input type="file" id="fileInput" accept="image/*" onchange="handleFileUpload(event)">
            
            <div id="previewContainer" class="preview-container">
                <img id="previewImage" alt="Preview">
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="scanImage()">üîç ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <button class="btn btn-secondary" onclick="clearPreview()">üóë ‡¶∏‡¶æ‡¶´ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>
        </div>

        <!-- Loading -->
        <div id="loading" class="loading" style="display: none;">
            ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
        </div>

        <!-- Result Section -->
        <div id="resultSection" class="result-section">
            <div class="result-title">üìã ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶® ‡¶´‡¶≤‡¶æ‡¶´‡¶≤</div>
            <div id="resultContent" class="result-content"></div>
            <div class="result-actions">
                <button class="btn btn-primary" onclick="copyResult()">üìã ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <button class="btn btn-secondary" onclick="shareResult()">üì§ ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </div>

        <!-- Error Section -->
        <div id="errorSection" class="error" style="display: none;">
            <div id="errorMessage"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsqr/1.4.0/jsQR.js" integrity="sha512-dxNMqrsu4MhRVAlJn8WzuCOjm9XV8DJbj5lj8K6mXhCvcdmhPROhJ2RgmOJDLgECMU9rKRJLLLvIKgSjY5gRvw==" crossorigin="anonymous"></script>
    <script>
        // Wait for jsQR to load
        function waitForJsQR() {
            return new Promise((resolve, reject) => {
                if (typeof jsQR !== 'undefined') {
                    resolve();
                } else {
                    let attempts = 0;
                    const maxAttempts = 50; // 5 seconds
                    const checkInterval = setInterval(() => {
                        attempts++;
                        if (typeof jsQR !== 'undefined') {
                            clearInterval(checkInterval);
                            resolve();
                        } else if (attempts >= maxAttempts) {
                            clearInterval(checkInterval);
                            reject(new Error('jsQR library failed to load'));
                        }
                    }, 100);
                }
            });
        }

        let video = document.getElementById('video');
        let canvas = document.createElement('canvas');
        let context = canvas.getContext('2d');
        let currentStream = null;
        let scanning = false;
        let lastResult = '';
        let jsQRReady = false;

        // Mode switching
        function switchMode(mode) {
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.scanner-section').forEach(section => section.classList.remove('active'));
            
            if (mode === 'camera') {
                document.querySelector('.mode-btn').classList.add('active');
                document.getElementById('cameraSection').classList.add('active');
                stopCamera();
            } else {
                document.querySelectorAll('.mode-btn')[1].classList.add('active');
                document.getElementById('uploadSection').classList.add('active');
                stopCamera();
            }
            
            hideResult();
            hideError();
        }

        // Camera functions
        async function startCamera() {
            try {
                hideError();
                showLoading('‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá');
                
                // Check if running in secure context (HTTPS)
                if (location.protocol !== 'https:' && location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
                    hideLoading();
                    showError('‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø HTTPS ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá HTTPS ‡¶∏‡¶æ‡¶á‡¶ü‡ßá ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                    return;
                }
                
                const constraints = {
                    video: {
                        facingMode: { ideal: 'environment' },
                        width: { ideal: 1280, min: 640 },
                        height: { ideal: 720, min: 480 }
                    }
                };

                currentStream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = currentStream;
                
                video.onloadedmetadata = () => {
                    video.play().then(() => {
                        hideLoading();
                        scanning = true;
                        scanFromCamera();
                    }).catch(err => {
                        hideLoading();
                        showError('‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
                    });
                };
                
            } catch (error) {
                hideLoading();
                console.error('Camera error:', error);
                let errorMsg = '‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§';
                
                if (error.name === 'NotAllowedError') {
                    errorMsg = '‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø ‡¶¶‡¶ø‡¶®‡•§ ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∂‡ßá ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶Ü‡¶á‡¶ï‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§';
                } else if (error.name === 'NotFoundError') {
                    errorMsg = '‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶Ö‡¶™‡¶∂‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§';
                } else if (error.name === 'NotSupportedError') {
                    errorMsg = '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ‡•§';
                }
                
                showError(errorMsg);
            }
        }

        function stopCamera() {
            scanning = false;
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
                currentStream = null;
            }
            video.srcObject = null;
        }

        function scanFromCamera() {
            if (!scanning || !jsQRReady) return;

            if (video.readyState === video.HAVE_ENOUGH_DATA) {
                try {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    context.drawImage(video, 0, 0, canvas.width, canvas.height);
                    
                    const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
                    
                    // Check if jsQR is available before using
                    if (typeof jsQR !== 'undefined') {
                        const code = jsQR(imageData.data, imageData.width, imageData.height, {
                            inversionAttempts: "dontInvert",
                        });
                        
                        if (code && code.data) {
                            displayResult(code.data);
                            return;
                        }
                    }
                } catch (error) {
                    console.error('Camera scan error:', error);
                }
            }
            
            requestAnimationFrame(scanFromCamera);
        }

        // File upload functions
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const previewImage = document.getElementById('previewImage');
                previewImage.src = e.target.result;
                document.getElementById('previewContainer').style.display = 'block';
                hideResult();
                hideError();
            };
            reader.readAsDataURL(file);
        }

        function scanImage() {
            const previewImage = document.getElementById('previewImage');
            if (!previewImage.src) {
                showError('‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                return;
            }

            if (!jsQRReady) {
                showError('QR ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶è‡¶ñ‡¶®‡¶ì ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§ ‡¶ï‡¶ø‡¶õ‡ßÅ‡¶ï‡ßç‡¶∑‡¶£ ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                return;
            }

            showLoading('‡¶õ‡¶¨‡¶ø ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá');

            // Add delay to ensure image is fully loaded
            setTimeout(() => {
                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.onload = function() {
                    try {
                        canvas.width = img.width;
                        canvas.height = img.height;
                        context.drawImage(img, 0, 0);
                        
                        const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
                        
                        // Check if jsQR is available
                        if (typeof jsQR === 'undefined') {
                            hideLoading();
                            showError('QR ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶™‡ßá‡¶ú ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                            return;
                        }
                        
                        const code = jsQR(imageData.data, imageData.width, imageData.height, {
                            inversionAttempts: "dontInvert",
                        });
                        
                        hideLoading();
                        
                        if (code && code.data) {
                            displayResult(code.data);
                        } else {
                            // Try with inverted colors
                            const invertedCode = jsQR(imageData.data, imageData.width, imageData.height, {
                                inversionAttempts: "attemptBoth",
                            });
                            
                            if (invertedCode && invertedCode.data) {
                                displayResult(invertedCode.data);
                            } else {
                                showError('‡¶è‡¶á ‡¶õ‡¶¨‡¶ø‡¶§‡ßá ‡¶ï‡ßã‡¶®‡ßã QR ‡¶ï‡ßã‡¶° ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡ßç‡¶™‡¶∑‡ßç‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ QR ‡¶ï‡ßã‡¶° ‡¶õ‡¶¨‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                            }
                        }
                    } catch (error) {
                        hideLoading();
                        showError('‡¶õ‡¶¨‡¶ø ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
                        console.error('Image processing error:', error);
                    }
                };
                img.onerror = function() {
                    hideLoading();
                    showError('‡¶õ‡¶¨‡¶ø ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
                };
                img.src = previewImage.src;
            }, 100);
        }

        function clearPreview() {
            document.getElementById('previewContainer').style.display = 'none';
            document.getElementById('fileInput').value = '';
            hideResult();
            hideError();
        }

        // Result functions
        function displayResult(data) {
            lastResult = data;
            document.getElementById('resultContent').textContent = data;
            document.getElementById('resultSection').classList.add('show');
            
            // Auto-scroll to result
            document.getElementById('resultSection').scrollIntoView({
                behavior: 'smooth',
                block: 'nearest'
            });
        }

        function copyResult() {
            if (!lastResult) return;
            
            // Modern clipboard API
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(lastResult).then(() => {
                    showCopySuccess();
                }).catch(() => {
                    // Fallback for older browsers
                    fallbackCopyTextToClipboard(lastResult);
                });
            } else {
                // Fallback for older browsers
                fallbackCopyTextToClipboard(lastResult);
            }
        }

        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.top = "-999999px";
            textArea.style.left = "-999999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showCopySuccess();
                } else {
                    showError('‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
                }
            } catch (err) {
                showError('‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
            }

            document.body.removeChild(textArea);
        }

        function showCopySuccess() {
            const btn = document.querySelector('.result-actions .btn-primary');
            const originalText = btn.textContent;
            btn.textContent = '‚úì ‡¶ï‡¶™‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!';
            btn.style.background = 'linear-gradient(45deg, #00ff88, #00cc70)';
            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.background = 'linear-gradient(45deg, #00ff88, #00d4ff)';
            }, 2000);
        }

        function shareResult() {
            if (!lastResult) return;
            
            if (navigator.share) {
                navigator.share({
                    title: 'QR Scanner AR ‡¶´‡¶≤‡¶æ‡¶´‡¶≤',
                    text: lastResult
                });
            } else {
                copyResult();
            }
        }

        // Utility functions
        function showLoading(message) {
            const loading = document.getElementById('loading');
            loading.textContent = message;
            loading.style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorSection').style.display = 'block';
            setTimeout(hideError, 5000);
        }

        function hideError() {
            document.getElementById('errorSection').style.display = 'none';
        }

        function hideResult() {
            document.getElementById('resultSection').classList.remove('show');
        }

        // Drag and drop functionality
        const uploadArea = document.querySelector('.upload-area');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('drag-over');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('drag-over');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                if (file.type.startsWith('image/')) {
                    const fileInput = document.getElementById('fileInput');
                    fileInput.files = files;
                    handleFileUpload({ target: fileInput });
                }
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Initializing QR Scanner AR...');
            
            try {
                // Wait for jsQR library to load
                await waitForJsQR();
                jsQRReady = true;
                console.log('jsQR library loaded successfully');
            } catch (error) {
                console.error('Failed to load jsQR library:', error);
                showError('QR ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶≤‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡ßá‡¶∞‡¶ø ‡¶≤‡ßã‡¶° ‡¶π‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶™‡ßá‡¶ú ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                return;
            }

            // Check if camera is available
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                console.log('Camera not supported, switching to upload mode');
                switchMode('upload');
            }

            // Check if running on HTTPS (required for camera)
            if (location.protocol !== 'https:' && location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
                console.log('HTTPS required for camera access');
            }

            // Initialize canvas context
            if (!canvas.getContext) {
                showError('‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ HTML5 Canvas ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ‡•§');
                return;
            }

            console.log('QR Scanner AR initialized successfully');
        });
    </script>
</body>
</html>